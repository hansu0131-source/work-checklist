<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ¥• ë‹¹ - ìˆ™ì œ ê´€ë¦¬ì</title>

<!-- Firebase compat SDK -->
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

<style>
    * { box-sizing:border-box; }

    body {
        background:#FFF5E8;
        font-family:-apple-system,BlinkMacSystemFont,"Pretendard",system-ui,sans-serif;
        margin:0; padding:16px; color:#4b3525;
    }

    h1 {
        text-align:center; color:#ff8a3c;
        margin:0 0 6px 0; font-size:22px;
    }

    .tag {
        text-align:center; font-size:12px; color:#fff;
        background:#ffb37a; padding:4px 12px;
        border-radius:999px; display:inline-block;
        margin-left:50%; transform:translateX(-50%);
        margin-bottom:18px;
    }

    .section-title {
        font-size:15px; font-weight:700;
        margin-bottom:8px; color:#ff8a3c;
        display:flex; align-items:center; gap:6px;
    }

    .section-title span.sub {
        font-size:12px; font-weight:400; color:#b07b55;
    }

    .card {
        background:#ffffff; padding:12px;
        border-radius:14px; box-shadow:0 3px 10px rgba(255,150,95,0.22);
        margin-bottom:16px;
    }

    textarea {
        width:100%; min-height:70px;
        border-radius:10px; border:1px solid #ffcfac;
        padding:8px; resize:vertical;
        font-family:inherit; font-size:13px;
        background:#fffdfa;
    }

    button {
        padding:8px 14px; border:none;
        border-radius:999px; background:#ff8a3c;
        color:white; font-weight:600;
        cursor:pointer; font-size:13px;
    }

    button:active { transform:translateY(1px); }

    .btn-sub { background:#ffd2ae; color:#9f4e23; }
    .btn-danger { background:#ffebe1; color:#ff5c37; }

    .pill {
        display:inline-flex; align-items:center;
        padding:4px 10px; border-radius:999px;
        background:#ffe9d7; font-size:12px; margin:2px; gap:6px;
    }

    .input-line {
        display:flex; gap:8px; margin-bottom:8px;
    }

    /* â† ëª¨ë°”ì¼ ì‚ì ¸ë‚˜ì˜´ ë¬¸ì œ í•´ê²° */
    .input-line input[type="text"],
    .input-line input[type="number"] {
        flex:1;
        min-width:0;   /* â˜… ì¤‘ìš”: ëª¨ë°”ì¼ í­ ì •ìƒí™” */
        padding:7px;
        border-radius:9px; border:1px solid #ffd1a4;
        font-size:13px; background:#fffdfa;
    }

    .summary-table { width:100%; border-collapse:collapse; font-size:12px; margin-top:4px; }
    .summary-table th, .summary-table td {
        border:1px solid #ffe0c6; padding:4px 6px; text-align:center;
        white-space:nowrap;
    }
    .summary-table th {
        background:#ffe7cf; font-weight:600; color:#8f532d;
    }
    .summary-label-cell { font-weight:600; background:#fff2df; }

    .field-list .label { font-size:12px; color:#9a6340; margin-bottom:4px; }

    .space-card {
        margin-bottom:10px; padding:10px;
        border-radius:12px; background:#fffdf8;
        border:1px solid #ffe4c9; box-shadow:0 2px 6px rgba(0,0,0,0.03);
    }

    .space-header { display:flex; justify-content:space-between; align-items:center; gap:6px; margin-bottom:6px; }
    .badge-nick {
        font-size:13px; font-weight:600;
        padding:4px 10px; border-radius:999px;
        background:#ffe0c2; color:#8b4b20;
    }

    .badge-id {
        font-size:11px; padding:4px 8px;
        border-radius:999px; background:#fff6eb;
        color:#a85a23; display:inline-flex; align-items:center; gap:4px;
    }

    .badge-id button {
        padding:2px 6px; font-size:10px;
        border-radius:999px; background:#ffbf86; color:#fff;
    }

    .space-fields { display:flex; flex-wrap:wrap; gap:6px; }

    .field-chip {
        display:inline-flex; align-items:center; gap:4px;
        padding:4px 8px; border-radius:999px;
        background:#fff2de; font-size:11px;
    }

    .field-chip input[type="checkbox"] {
        width:16px; height:16px;
        accent-color:#ff8a3c; margin:0;
    }

    .space-memo textarea { min-height:50px; font-size:12px; }

    @media (min-width:720px){
        body{ max-width:640px; margin:0 auto; }
    }
</style>
</head>

<body>

<h1>ğŸ¥• ë‹¹ - ìˆ™ì œ ê´€ë¦¬ì</h1>
<div class="tag">ê´€ë¦¬ì ID: ë‹¹ (ì£¼í™©)</div>


<!-- -------------------------------
     ğŸ¥• ì˜¤ëŠ˜ì˜ í•œë§ˆë””
-------------------------------- -->
<div class="card">
    <div class="section-title">ğŸ“Œ ì˜¤ëŠ˜ì˜ í•œë§ˆë”” <span class="sub">(ê´€ë¦¬ì â†” ì‚¬ìš©ì)</span></div>

    <div class="input-small-label">ğŸ¥• ê´€ë¦¬ì â†’ ì‚¬ìš©ì</div>
    <textarea id="adminMessage" placeholder="ë‚­ì—ê²Œ ì˜¤ëŠ˜ ì „í•˜ê³  ì‹¶ì€ ë§"></textarea>
    <div style="margin-top:6px; text-align:right;">
        <button onclick="saveAdminMessage()">ê´€ë¦¬ì í•œë§ˆë”” ì €ì¥</button>
    </div>

    <div style="height:10px;"></div>

    <div class="input-small-label">ğŸ° ì‚¬ìš©ì â†’ ê´€ë¦¬ì</div>
    <div id="userMessageBox"
         style="white-space:pre-line; padding:8px; border-radius:10px; border:1px solid #ffd7c2; background:#fff8f3; font-size:13px;">
        (ì•„ì§ ì‚¬ìš©ì ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤)
    </div>
</div>


<!-- -------------------------------
     ğŸ“Š ì˜¤ëŠ˜ ìˆ™ì œ ìš”ì•½
-------------------------------- -->
<div class="card">
    <div class="section-title">ğŸ“Š ì˜¤ëŠ˜ ìˆ™ì œ ìš”ì•½</div>
    <div class="small-helper">â€» ì˜¤ëŠ˜ ê¸°ì¤€ìœ¼ë¡œ ì§ì ‘ ìˆ«ìë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.</div>

    <table class="summary-table">
        <tr>
            <th></th>
            <th>ì—­íŒ¬</th>
            <th>ë°©ì…€</th>
            <th>ìˆ™ì œ</th>
            <th>ì‚¬ì§„</th>
            <th>ì›€ì§¤</th>
        </tr>
        <tr class="summary-input-row">
            <td class="summary-label-cell">ì˜¤ëŠ˜</td>
            <td><input type="number" id="today-ì—­íŒ¬" min="0" value="0"></td>
            <td><input type="number" id="today-ë°©ì…€" min="0" value="0"></td>
            <td><input type="number" id="today-ìˆ™ì œ" min="0" value="0"></td>
            <td><input type="number" id="today-ì‚¬ì§„" min="0" value="0"></td>
            <td><input type="number" id="today-ì›€ì§¤" min="0" value="0"></td>
        </tr>
    </table>

    <div style="margin-top:8px; text-align:right;">
        <button class="btn-sub" onclick="saveSummaryToday()">ì˜¤ëŠ˜ ìš”ì•½ ì €ì¥</button>
    </div>
</div>


<!-- -------------------------------
     ğŸ“Š ëˆ„ì  ìˆ™ì œ ìš”ì•½
-------------------------------- -->
<div class="card">
    <div class="section-title">ğŸ“Š ëˆ„ì  ìˆ™ì œ ìš”ì•½</div>
    <div class="small-helper">â€» ì „ì²´ ëˆ„ì ê°’ì…ë‹ˆë‹¤. í•„ìš” ì‹œ ì§ì ‘ ìˆ˜ì •í•˜ì„¸ìš”.</div>

    <table class="summary-table">
        <tr>
            <th></th>
            <th>ì—­íŒ¬</th>
            <th>ë°©ì…€</th>
            <th>ìˆ™ì œ</th>
            <th>ì‚¬ì§„</th>
            <th>ì›€ì§¤</th>
        </tr>
        <tr class="summary-input-row">
            <td class="summary-label-cell">ëˆ„ì </td>
            <td><input type="number" id="total-ì—­íŒ¬" min="0" value="0"></td>
            <td><input type="number" id="total-ë°©ì…€" min="0" value="0"></td>
            <td><input type="number" id="total-ìˆ™ì œ" min="0" value="0"></td>
            <td><input type="number" id="total-ì‚¬ì§„" min="0" value="0"></td>
            <td><input type="number" id="total-ì›€ì§¤" min="0" value="0"></td>
        </tr>
    </table>

    <div style="margin-top:8px; text-align:right;">
        <button class="btn-sub" onclick="saveSummaryTotal()">ëˆ„ì  ìš”ì•½ ì €ì¥</button>
    </div>
</div>


<!-- -------------------------------
     ğŸ“‹ ìˆ™ì œ ëŒ€ìƒ ì¶”ê°€
-------------------------------- -->
<div class="card">
    <div class="section-title">ğŸ“‹ ìˆ™ì œ ëŒ€ìƒ ì¶”ê°€</div>
    <div class="input-small-label">ë‹‰ë„¤ì„ / ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ê³  í–‰ì„ ì¶”ê°€í•˜ì„¸ìš”.</div>
    <div class="input-line">
        <input type="text" id="newNick" placeholder="ë‹‰ë„¤ì„">
        <input type="text" id="newID" placeholder="ì•„ì´ë””">
        <button onclick="addSpace()">ì¶”ê°€</button>
    </div>
</div>


<!-- -------------------------------
     ğŸ“Œ í•­ëª© ê´€ë¦¬
-------------------------------- -->
<div class="card">
    <div class="section-title">ğŸ“Œ í•­ëª© ê´€ë¦¬</div>
    <div class="input-small-label">ì²´í¬ í•­ëª©ì„ ì¶”ê°€í•˜ê±°ë‚˜ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
    <div class="input-line">
        <input type="text" id="newField" placeholder="ìƒˆ í•­ëª© ì´ë¦„ (ì˜ˆ: ì—­íŒ¬ / ë°©ì…€ / ìˆ™ì œ ...)">
        <button onclick="addField()">í•­ëª© ì¶”ê°€</button>
    </div>
    <div class="field-list">
        <div class="label">í˜„ì¬ í•­ëª©ë“¤</div>
        <div id="fieldPills"></div>
    </div>
</div>


<!-- -------------------------------
     ğŸ“¦ ìˆ™ì œ ì¹´ë“œ ëª©ë¡
-------------------------------- -->
<div class="card">
    <div class="section-title">ğŸ“¦ ìˆ™ì œ ì¹´ë“œ ëª©ë¡</div>
    <div class="small-helper">ê° ì¹´ë“œì—ì„œ ì²´í¬/ë©”ëª¨ë¥¼ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
    <div id="spacesContainer"></div>
</div>


<script>
/* Firebase ì´ˆê¸°í™” */
const firebaseConfig = {
    apiKey:"AIzaSyAHmLNi5VOuAE-gXnAg-fEfzylPZvzvfVo",
    authDomain:"daily-checklist-91e5a.firebaseapp.com",
    projectId:"daily-checklist-91e5a",
    storageBucket:"daily-checklist-91e5a.firebasestorage.app",
    messagingSenderId:"66394691958",
    appId:"1:66394691958:web:cf91f295456a2e10d18257",
    measurementId:"G-87WK4N4EGH"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* Firestore ì°¸ì¡° */
const todayMessagesRef = db.collection("today").doc("messages");
const summaryTodayRef  = db.collection("summary").doc("today");
const summaryTotalRef  = db.collection("summary").doc("total");
const configRef        = db.collection("config").doc("checklist");
const spacesRef        = db.collection("spaces");

/* ìƒíƒœ */
const statNames = ["ì—­íŒ¬","ë°©ì…€","ìˆ™ì œ","ì‚¬ì§„","ì›€ì§¤"];
let fields = [];
let spacesData = [];

/* ê¸°ë³¸ Summary */
const emptySummary = { "ì—­íŒ¬":0, "ë°©ì…€":0, "ìˆ™ì œ":0, "ì‚¬ì§„":0, "ì›€ì§¤":0 };

/* -------------------------------
   ğŸ¥• ì˜¤ëŠ˜ì˜ í•œë§ˆë”” ì‹¤ì‹œê°„ ë°˜ì˜
-------------------------------- */
todayMessagesRef.onSnapshot(doc=>{
    if(!doc.exists){
        todayMessagesRef.set({
            adminMessage:"",
            userMessage:"",
            date:new Date().toISOString()
        },{merge:true});
        return;
    }
    const data = doc.data();
    document.getElementById("adminMessage").value = data.adminMessage || "";
    document.getElementById("userMessageBox").innerText =
        data.userMessage || "(ì•„ì§ ì‚¬ìš©ì ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤)";
});

/* -------------------------------
   ğŸ“Š ì˜¤ëŠ˜ ìš”ì•½ ì‹¤ì‹œê°„
-------------------------------- */
summaryTodayRef.onSnapshot(doc=>{
    if(!doc.exists){
        summaryTodayRef.set(emptySummary,{merge:true});
        return;
    }
    const data = doc.data();
    statNames.forEach(name=>{
        const el = document.getElementById("today-"+name);
        if(el) el.value = data[name] ?? 0;
    });
});

/* -------------------------------
   ğŸ“Š ëˆ„ì  ìš”ì•½ ì‹¤ì‹œê°„
-------------------------------- */
summaryTotalRef.onSnapshot(doc=>{
    if(!doc.exists){
        summaryTotalRef.set(emptySummary,{merge:true});
        return;
    }
    const data = doc.data();
    statNames.forEach(name=>{
        const el = document.getElementById("total-"+name);
        if(el) el.value = data[name] ?? 0;
    });
});

/* -------------------------------
   ğŸ“Œ í•­ëª© ì‹¤ì‹œê°„ ë¡œë“œ
-------------------------------- */
configRef.onSnapshot(doc=>{
    if(!doc.exists){
        configRef.set({fields:[]});
        return;
    }
    fields = doc.data().fields || [];
    renderFieldPills();
    renderSpaces();
});

/* -------------------------------
   ğŸ“¦ spaces ì‹¤ì‹œê°„ ë¡œë“œ
-------------------------------- */
spacesRef.onSnapshot(snapshot=>{
    spacesData = snapshot.docs.map(d => ({ id:d.id, ...d.data() }));
    renderSpaces();
});


/* -------------------- ì €ì¥ */

function saveAdminMessage(){
    const msg = document.getElementById("adminMessage").value;
    todayMessagesRef.set({
        adminMessage:msg,
        date:new Date().toISOString()
    },{merge:true});
    alert("ê´€ë¦¬ì í•œë§ˆë”” ì €ì¥ ì™„ë£Œ!");
}

function saveSummaryToday(){
    const payload = {};
    statNames.forEach(name=>{
        payload[name] = Number(document.getElementById("today-"+name).value || 0);
    });
    summaryTodayRef.set(payload,{merge:true});
    alert("ì˜¤ëŠ˜ ìš”ì•½ ì €ì¥ ì™„ë£Œ!");
}

function saveSummaryTotal(){
    const payload = {};
    statNames.forEach(name=>{
        payload[name] = Number(document.getElementById("total-"+name).value || 0);
    });
    summaryTotalRef.set(payload,{merge:true});
    alert("ëˆ„ì  ìš”ì•½ ì €ì¥ ì™„ë£Œ!");
}


/* -------------------- í•­ëª© ì¶”ê°€/ì‚­ì œ */

function addField(){
    const input=document.getElementById("newField");
    const name=input.value.trim();
    if(!name) return;

    configRef.update({
        fields:firebase.firestore.FieldValue.arrayUnion(name)
    });
    input.value="";
}

function deleteField(name){
    if(!confirm(`"${name}" í•­ëª©ì„ ì‚­ì œí• ê¹Œìš”?`)) return;
    configRef.update({
        fields:firebase.firestore.FieldValue.arrayRemove(name)
    });
}

function renderFieldPills(){
    const wrap=document.getElementById("fieldPills");
    wrap.innerHTML="";
    if(!fields.length){
        wrap.innerHTML='<div class="small-helper">ì•„ì§ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
        return;
    }
    fields.forEach(name=>{
        wrap.innerHTML += `
            <div class="pill">
                <span>${name}</span>
                <button onclick="deleteField('${name}')">X</button>
            </div>`;
    });
}


/* -------------------- í–‰ ì¶”ê°€ */

function addSpace(){
    const nick=document.getElementById("newNick").value.trim();
    const id=document.getElementById("newID").value.trim();

    if(!nick || !id){
        alert("ë‹‰ë„¤ì„ê³¼ ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
    }

    spacesRef.add({
        nickname:nick,
        userid:id,
        memo:"",
        checks:{}
    });

    document.getElementById("newNick").value="";
    document.getElementById("newID").value="";
}


/* -------------------- ë³µì‚¬ ê¸°ëŠ¥ */

function copyUserId(value){
    if(!value) return;
    navigator.clipboard.writeText(value)
        .then(()=>alert("ì•„ì´ë”” ë³µì‚¬ë¨: "+value))
        .catch(()=>alert("ë³µì‚¬ ì‹¤íŒ¨. ì§ì ‘ ë³µì‚¬í•´ì£¼ì„¸ìš”."));
}


/* -------------------- Space ì—…ë°ì´íŠ¸ */

function updateSpaceField(id,field,value){
    spacesRef.doc(id).update({ [field]:value });
}

function updateSpaceCheck(id,field,checked){
    spacesRef.doc(id).update({
        ["checks."+field]:checked
    });
}

function deleteSpace(id){
    if(!confirm("ì´ í–‰ì„ ì‚­ì œí• ê¹Œìš”?")) return;
    spacesRef.doc(id).delete();
}


/* -------------------- Space ì¹´ë“œ ë Œë” */

function renderSpaces(){
    const container=document.getElementById("spacesContainer");
    container.innerHTML="";

    if(!spacesData.length){
        container.innerHTML='<div class="small-helper">ì•„ì§ ë“±ë¡ëœ ëŒ€ìƒì´ ì—†ìŠµë‹ˆë‹¤.</div>';
        return;
    }

    spacesData.forEach(item=>{
        const checks=item.checks||{};
        container.innerHTML += `
            <div class="space-card">
                <div class="space-header">
                    <div>
                        <div class="badge-nick">
                            ë‹‰ë„¤ì„:
                            <input type="text"
                                value="${item.nickname||""}"
                                style="border:none;background:transparent;width:120px;font-size:13px;"
                                onchange="updateSpaceField('${item.id}','nickname',this.value)">
                        </div>

                        <div class="badge-id">
                            <span>ì•„ì´ë””: ${item.userid||""}</span>
                            <button onclick="copyUserId('${item.userid||""}')">ë³µì‚¬</button>
                        </div>
                    </div>

                    <button class="btn-danger" onclick="deleteSpace('${item.id}')">í–‰ ì‚­ì œ</button>
                </div>

                <div class="space-fields">
                    ${fields.map(name=>`
                        <div class="field-chip">
                            <input type="checkbox"
                                ${checks[name]?"checked":""}
                                onchange="updateSpaceCheck('${item.id}','${name}',this.checked)">
                            <span>${name}</span>
                        </div>`).join("")}
                </div>

                <div class="space-memo">
                    <div class="input-small-label" style="margin-top:6px;">ë©”ëª¨</div>
                    <textarea
                        onchange="updateSpaceField('${item.id}','memo',this.value)">${item.memo||""}</textarea>
                </div>
            </div>
        `;
    });
}
</script>

</body>
</html>