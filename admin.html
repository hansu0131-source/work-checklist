<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ¥• ë‹¹ - ìˆ™ì œ ê´€ë¦¬ì</title>

<!-- Firebase compat SDK -->
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

<style>
    body {
        background: linear-gradient(180deg, #ffe9d4 0%, #fff8f0 100%);
        font-family: Pretendard, sans-serif;
        margin: 0;
        padding: 20px;
    }

    h1 {
        text-align: center;
        color: #ff8a3c;
        margin-bottom: 10px;
    }

    .tag {
        text-align: center;
        font-size: 13px;
        color: #fff;
        background: #ffb37a;
        padding: 4px 12px;
        border-radius: 999px;
        display: inline-block;
        margin-bottom: 20px;
        margin-left: 50%;
        transform: translateX(-50%);
    }

    table {
        width: 100%;
        border-collapse: collapse;
        background: #ffffff;
        border-radius: 14px;
        overflow: hidden;
        box-shadow: 0 3px 10px rgba(255, 150, 95, 0.25);
        margin-top: 20px;
    }

    th {
        background: #ffb37a;
        padding: 10px;
        color: white;
        font-weight: 600;
    }

    td {
        border-bottom: 1px solid #ffe1cc;
        padding: 10px;
        text-align: center;
    }

    input[type="text"] {
        padding: 6px;
        border-radius: 8px;
        border: 1px solid #ffd1a4;
        width: 90%;
    }

    textarea {
        width: 95%;
        border-radius: 8px;
        border: 1px solid #ffd1a4;
        padding: 6px;
        resize: vertical;
        min-height: 50px;
    }

    .add-box {
        display: flex;
        gap: 10px;
        margin: 10px 0;
    }

    button {
        padding: 10px 14px;
        border: none;
        border-radius: 10px;
        background: #ff8a3c;
        color: white;
        cursor: pointer;
        font-weight: 600;
    }

    .delete-btn {
        background: #ffe1cc;
        color: #ff6b3b;
        padding: 6px 10px;
        font-size: 12px;
    }
</style>
</head>

<body>

<h1>ğŸ¥• ë‹¹ - ìˆ™ì œ ê´€ë¦¬ì</h1>
<div class="tag">ê´€ë¦¬ì ID: ë‹¹ (ì£¼í™©)</div>

<!-- í•­ëª© ì¶”ê°€ -->
<div class="add-box">
    <input type="text" id="newField" placeholder="ìƒˆ í•­ëª© ì´ë¦„ (ì˜ˆ: ë°©ì…€)">
    <button onclick="addField()">í•­ëª© ì¶”ê°€</button>
</div>

<!-- í–‰ ì¶”ê°€ -->
<div class="add-box">
    <input type="text" id="newNick" placeholder="ë‹‰ë„¤ì„">
    <input type="text" id="newID" placeholder="ì•„ì´ë””">
    <button onclick="addRow()">í–‰ ì¶”ê°€</button>
</div>

<table id="table">
    <thead id="thead"></thead>
    <tbody id="tbody"></tbody>
</table>

<script>
/* ğŸ”¥ Firebase ì„¤ì • */
const firebaseConfig = {
    apiKey: "AIzaSyAHmLNi5VOuAE-gXnAg-fEfzylPZvzvfVo",
    authDomain: "daily-checklist-91e5a.firebaseapp.com",
    projectId: "daily-checklist-91e5a",
    storageBucket: "daily-checklist-91e5a.firebasestorage.app",
    messagingSenderId: "66394691958",
    appId: "1:66394691958:web:cf91f295456a2e10d18257",
    measurementId: "G-87WK4N4EGH"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* ğŸ”¥ Firestore ì°¸ì¡° */
const configRef = db.collection("config").doc("checklist");
const spacesRef = db.collection("spaces");

let fields = [];

/* í•­ëª©(ì—´) ë³€í™” ê°ì§€ */
configRef.onSnapshot(doc => {
    if (!doc.exists) {
        configRef.set({ fields: [] });
        return;
    }
    fields = doc.data().fields;
    renderTable();
});

/* í–‰(ë¬¸ì„œ) ë³€í™” ê°ì§€ */
spacesRef.onSnapshot(() => {
    renderTable();
});

/* ğŸ”§ í…Œì´ë¸” ë Œë”ë§ */
function renderTable() {
    const thead = document.getElementById("thead");
    const tbody = document.getElementById("tbody");

    thead.innerHTML = `
        <tr>
            <th>ë‹‰ë„¤ì„</th>
            <th>ì•„ì´ë””</th>
            ${fields.map(f => `<th>${f}</th>`).join("")}
            <th>ë©”ëª¨</th>
            <th>ì‚­ì œ</th>
        </tr>
    `;

    tbody.innerHTML = "";

    spacesRef.get().then(res => {
        res.forEach(doc => {
            const data = doc.data();
            const checks = data.checks || {};

            const row = document.createElement("tr");

            row.innerHTML = `
                <td><input type="text" value="${data.nickname || ""}" onchange="update('${doc.id}', 'nickname', this.value)"></td>
                <td><input type="text" value="${data.userid || ""}" onchange="update('${doc.id}', 'userid', this.value)"></td>

                ${fields
                    .map(f => `
                        <td>
                            <input type="checkbox" ${checks[f] ? "checked" : ""}
                                onchange="updateCheck('${doc.id}', '${f}', this.checked)">
                        </td>
                    `)
                    .join("")}

                <td><textarea onchange="update('${doc.id}', 'memo', this.value)">${data.memo || ""}</textarea></td>

                <td><button class="delete-btn" onclick="deleteRow('${doc.id}')">ì‚­ì œ</button></td>
            `;

            tbody.appendChild(row);
        });
    });
}

/* ğŸ”§ í•­ëª© ì¶”ê°€ */
function addField() {
    const f = document.getElementById("newField").value.trim();
    if (!f) return;

    configRef.update({
        fields: firebase.firestore.FieldValue.arrayUnion(f)
    });

    document.getElementById("newField").value = "";
}

/* ğŸ”§ í–‰ ì¶”ê°€ */
function addRow() {
    const nick = document.getElementById("newNick").value.trim();
    const id = document.getElementById("newID").value.trim();
    if (!nick || !id) return;

    spacesRef.add({
        nickname: nick,
        userid: id,
        checks: {},
        memo: ""
    });

    document.getElementById("newNick").value = "";
    document.getElementById("newID").value = "";
}

/* ğŸ”§ ì—…ë°ì´íŠ¸ */
function update(docID, field, value) {
    spacesRef.doc(docID).update({ [field]: value });
}

/* ğŸ”§ ì²´í¬ ì—…ë°ì´íŠ¸ */
function updateCheck(docID, field, value) {
    spacesRef.doc(docID).update({
        [`checks.${field}`]: value
    });
}

/* ğŸ”§ í–‰ ì‚­ì œ */
function deleteRow(docID) {
    spacesRef.doc(docID).delete();
}
</script>

</body>
</html>
