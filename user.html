<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ° ë‚­ - ìˆ™ì œ ì²´í¬</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

<style>
    * { box-sizing: border-box; }

    body {
        background: #FFE9F4;
        font-family: -apple-system, BlinkMacSystemFont, "Pretendard", system-ui, sans-serif;
        margin: 0;
        padding: 16px;
        color: #854a67;
    }

    h1 {
        text-align: center;
        color: #ff6fa8;
        margin: 0 0 6px 0;
        font-size: 22px;
    }

    .tag {
        text-align: center;
        font-size: 12px;
        color: white;
        background: #ff9ac5;
        padding: 4px 12px;
        border-radius: 999px;
        display: inline-block;
        margin-left: 50%;
        transform: translateX(-50%);
        margin-bottom: 14px;
    }

    .card {
        background: #ffffff;
        padding: 12px;
        border-radius: 14px;
        box-shadow: 0 3px 10px rgba(255,150,170,0.22);
        margin-bottom: 16px;
    }

    .section-title {
        font-size: 15px;
        font-weight: 700;
        margin-bottom: 8px;
        color: #ff6fa8;
        display: flex;
        align-items: center;
        gap: 6px;
    }

    textarea {
        width: 100%;
        min-height: 70px;
        border-radius: 10px;
        border: 1px solid #ffbdd6;
        padding: 8px;
        resize: vertical;
        font-size: 13px;
        background: #fff8fc;
    }

    button {
        padding: 8px 14px;
        border: none;
        border-radius: 999px;
        background: #ff6fa8;
        color: white;
        font-weight: 600;
        cursor: pointer;
        font-size: 13px;
    }

    .summary-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 12px;
        margin-top: 4px;
    }

    .summary-table th,
    .summary-table td {
        border: 1px solid #ffd2e5;
        padding: 4px 6px;
        text-align: center;
        white-space: nowrap;
    }

    .summary-table th {
        background: #ffe0f0;
        font-weight: 600;
        color: #b64d7a;
    }

    .summary-label-cell {
        background: #fff3fa;
        font-weight: 600;
    }

    .space-card {
        margin-bottom: 12px;
        padding: 12px;
        border-radius: 12px;
        background: #fff7fb;
        border: 1px solid #ffd6e9;
        box-shadow: 0 2px 6px rgba(0,0,0,0.03);
    }

    .badge-nick {
        font-size: 14px;
        font-weight: 600;
        padding: 4px 10px;
        border-radius: 999px;
        background: #ffd4e7;
        color: #a2466b;
    }

    .badge-id {
        font-size: 11px;
        padding: 4px 8px;
        border-radius: 999px;
        background: #ffeaf4;
        color: #c25683;
        display: inline-flex;
        align-items: center;
        gap: 4px;
        margin-top:4px;
    }

    .field-chip {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        padding: 4px 8px;
        border-radius: 999px;
        background: #ffe6f2;
        font-size: 12px;
    }

    .field-chip input[type="checkbox"] {
        width: 17px;
        height: 17px;
        accent-color: #ff6fa8;
        margin: 0;
    }

    .input-small-label {
        font-size:11px;
        color:#a7638b;
        margin-bottom:4px;
    }

    @media (min-width:720px){
        body { max-width:640px; margin:0 auto; }
    }
</style>
</head>

<body>

<h1>ğŸ° ë‚­ - ìˆ™ì œ ì²´í¬</h1>
<div class="tag">ì‚¬ìš©ì ID: ë‚­ (í•‘í¬)</div>

<!-- ì˜¤ëŠ˜ì˜ í•œë§ˆë”” -->
<div class="card">
    <div class="section-title">ğŸ“Œ ì˜¤ëŠ˜ì˜ í•œë§ˆë””</div>

    <div class="input-small-label">ğŸ¥• ê´€ë¦¬ì â†’ ë‚­</div>
    <div id="adminMessageBox" style="white-space:pre-line; border:1px solid #ffd2e3; background:#fff4fa; padding:8px; border-radius:10px; min-height:40px;">
        (ê´€ë¦¬ìê°€ ì•„ì§ ë©”ì‹œì§€ë¥¼ ë‚¨ê¸°ì§€ ì•Šì•˜ì–´ìš”)
    </div>

    <div style="height:10px;"></div>

    <div class="input-small-label">ğŸ° ë‚­ â†’ ê´€ë¦¬ì</div>
    <textarea id="userMessage" placeholder="ì˜¤ëŠ˜ í•˜ê³  ì‹¶ì€ ë§ì„ ì ì–´ì£¼ì„¸ìš”"></textarea>
    <div style="text-align:right; margin-top:6px;">
        <button onclick="saveUserMessage()">ì €ì¥</button>
    </div>
</div>

<!-- ìš”ì•½(ì˜¤ëŠ˜ + ëˆ„ì ) -->
<div class="card">
    <div class="section-title">ğŸ“Š ì˜¤ëŠ˜ì˜ ìˆ™ì œ ìš”ì•½</div>

    <table class="summary-table">
        <tr>
            <th></th>
            <th>ì—­íŒ¬</th>
            <th>ë°©ì…€</th>
            <th>ìˆ™ì œ</th>
            <th>ì‚¬ì§„</th>
            <th>ì›€ì§¤</th>
        </tr>
        <tr>
            <td class="summary-label-cell">ì˜¤ëŠ˜</td>
            <td id="today-ì—­íŒ¬">0</td>
            <td id="today-ë°©ì…€">0</td>
            <td id="today-ìˆ™ì œ">0</td>
            <td id="today-ì‚¬ì§„">0</td>
            <td id="today-ì›€ì§¤">0</td>
        </tr>
    </table>
</div>

<div class="card">
    <div class="section-title">ğŸ“Š ëˆ„ì  ìˆ™ì œ ìš”ì•½</div>

    <table class="summary-table">
        <tr>
            <th></th>
            <th>ì—­íŒ¬</th>
            <th>ë°©ì…€</th>
            <th>ìˆ™ì œ</th>
            <th>ì‚¬ì§„</th>
            <th>ì›€ì§¤</th>
        </tr>
        <tr>
            <td class="summary-label-cell">ëˆ„ì </td>
            <td id="total-ì—­íŒ¬">0</td>
            <td id="total-ë°©ì…€">0</td>
            <td id="total-ìˆ™ì œ">0</td>
            <td id="total-ì‚¬ì§„">0</td>
            <td id="total-ì›€ì§¤">0</td>
        </tr>
    </table>
</div>

<!-- ìˆ™ì œ ì¹´ë“œ ëª©ë¡ -->
<div class="card">
    <div class="section-title">ğŸ“¦ ìˆ™ì œ ì¹´ë“œ</div>
    <div id="spacesContainer"></div>
</div>

<script>
/* Firebase ì´ˆê¸°í™” */
const firebaseConfig = {
    apiKey: "AIzaSyAHmLNi5VOuAE-gXnAg-fEfzylPZvzvfVo",
    authDomain: "daily-checklist-91e5a.firebaseapp.com",
    projectId: "daily-checklist-91e5a",
    storageBucket: "daily-checklist-91e5a.firebasestorage.app",
    messagingSenderId: "66394691958",
    appId: "1:66394691958:web:cf91f295456a2e10d18257",
    measurementId: "G-87WK4N4EGH"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* ì°¸ì¡° */
const todayRef = db.collection("today").doc("messages");
const summaryTodayRef = db.collection("summary").doc("today");
const summaryTotalRef = db.collection("summary").doc("total");
const configRef = db.collection("config").doc("checklist");
const spacesRef = db.collection("spaces");

/* í•­ëª© ëª©ë¡ */
let fields = [];

/* ì˜¤ëŠ˜ì˜ í•œë§ˆë”” ì‹¤ì‹œê°„ */
todayRef.onSnapshot(doc => {
    if (doc.exists) {
        document.getElementById("adminMessageBox").innerText =
            doc.data().adminMessage || "(ê´€ë¦¬ìê°€ ì•„ì§ ë©”ì‹œì§€ë¥¼ ë‚¨ê¸°ì§€ ì•Šì•˜ì–´ìš”)";
    }
});

/* ì‚¬ìš©ì ë©”ì‹œì§€ ì €ì¥ */
function saveUserMessage() {
    const msg = document.getElementById("userMessage").value;
    todayRef.set({
        userMessage: msg,
        date: new Date().toISOString()
    }, { merge: true }).then(() => {
        alert("ì˜¤ëŠ˜ì˜ í•œë§ˆë””ë¥¼ ë³´ëƒˆì–´ìš”! ğŸ°");
    });
}

/* ìš”ì•½ - ì˜¤ëŠ˜ */
summaryTodayRef.onSnapshot(doc => {
    if (!doc.exists) return;
    const data = doc.data();
    ["ì—­íŒ¬","ë°©ì…€","ìˆ™ì œ","ì‚¬ì§„","ì›€ì§¤"].forEach(name=>{
        document.getElementById("today-"+name).innerText = data[name] ?? 0;
    });
});

/* ìš”ì•½ - ëˆ„ì  */
summaryTotalRef.onSnapshot(doc => {
    if (!doc.exists) return;
    const data = doc.data();
    ["ì—­íŒ¬","ë°©ì…€","ìˆ™ì œ","ì‚¬ì§„","ì›€ì§¤"].forEach(name=>{
        document.getElementById("total-"+name).innerText = data[name] ?? 0;
    });
});

/* í•­ëª© ë°›ì•„ì˜¤ê¸° */
configRef.onSnapshot(doc => {
    if (!doc.exists) return;
    fields = doc.data().fields || [];
    renderSpaces();
});

/* spaces ë°›ì•„ì˜¤ê¸° */
spacesRef.onSnapshot(snapshot => {
    const list = snapshot.docs.map(doc=>({ id:doc.id, ...doc.data() }));
    renderSpaces(list);
});

/* ì²´í¬ ì—…ë°ì´íŠ¸ */
function updateCheck(id, field, value) {
    spacesRef.doc(id).update({
        ["checks."+field]: value
    });
}

/* ë©”ëª¨ ì—…ë°ì´íŠ¸ */
function updateMemo(id, value) {
    spacesRef.doc(id).update({ memo:value });
}

/* ì²´í¬ì¹´ë“œ ë Œë”ë§ */
function renderSpaces(data=[]) {
    const container = document.getElementById("spacesContainer");
    container.innerHTML = "";

    if (!data.length) {
        container.innerHTML = '<div style="font-size:12px; color:#b37a99;">ì•„ì§ ì¶”ê°€ëœ ìˆ™ì œê°€ ì—†ì–´ìš”.</div>';
        return;
    }

    data.forEach(item => {
        const checks = item.checks || {};

        const card = document.createElement("div");
        card.className = "space-card";

        card.innerHTML = `
            <div class="badge-nick">ë‹‰ë„¤ì„: ${item.nickname}</div>
            <div class="badge-id">ì•„ì´ë””: ${item.userid}</div>

            <div style="height:8px;"></div>

            <div>
                ${fields.map(name => `
                    <div class="field-chip">
                        <input type="checkbox"
                            ${checks[name] ? "checked" : ""}
                            onchange="updateCheck('${item.id}', '${name}', this.checked)">
                        <span>${name}</span>
                    </div>
                `).join("")}
            </div>

            <div style="height:8px;"></div>

            <div class="input-small-label">ë©”ëª¨</div>
            <textarea onchange="updateMemo('${item.id}', this.value)">${item.memo||""}</textarea>
        `;

        container.appendChild(card);
    });
}
</script>

</body>
</html>