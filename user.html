<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ° ë‚­ - ìˆ™ì œ ì²´í¬</title>

<!-- Firebase compat SDK -->
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

<style>
    *{ box-sizing:border-box; }

    body{
        background:#FFE6F3;
        font-family:-apple-system,BlinkMacSystemFont,"Pretendard",system-ui,sans-serif;
        margin:0; padding:16px; color:#4b3045;
    }

    h1{
        text-align:center;
        color:#ff6fa8;
        margin:0 0 6px 0;
        font-size:22px;
    }

    .tag{
        text-align:center;
        font-size:12px;
        color:#fff;
        background:#ff9ac5;
        padding:4px 12px;
        border-radius:999px;
        display:inline-block;
        margin-left:50%;
        transform:translateX(-50%);
        margin-bottom:18px;
    }

    .card{
        background:#ffffff;
        padding:12px;
        border-radius:14px;
        box-shadow:0 3px 10px rgba(255,140,170,0.22);
        margin-bottom:16px;
    }

    .section-title{
        font-size:15px;
        font-weight:700;
        margin-bottom:8px;
        color:#ff6fa8;
        display:flex;
        align-items:center;
        gap:6px;
    }

    .section-title span.sub{
        font-size:12px;
        font-weight:400;
        color:#b05b86;
    }

    .input-small-label{
        font-size:12px;
        color:#7a4765;
        margin-bottom:4px;
    }

    textarea{
        width:100%;
        min-height:70px;
        border-radius:10px;
        border:1px solid #ffc2dd;
        padding:8px;
        resize:vertical;
        font-family:inherit;
        font-size:13px;
        background:#fff7fb;
    }

    button{
        padding:8px 14px;
        border:none;
        border-radius:999px;
        background:#ff6fa8;
        color:white;
        font-weight:600;
        cursor:pointer;
        font-size:13px;
    }
    button:active{ transform:translateY(1px); }

    .btn-save{
        background:#ff6fa8;
    }

    .summary-table{
        width:100%;
        border-collapse:collapse;
        font-size:12px;
        margin-top:4px;
    }
    .summary-table th,
    .summary-table td{
        border:1px solid #ffd3ea;
        padding:4px 6px;
        text-align:center;
        white-space:nowrap;
    }
    .summary-table th{
        background:#ffc7e4;
        font-weight:600;
        color:#993f6b;
    }
    .summary-label-cell{
        background:#ffe3f2;
        font-weight:600;
    }

    .space-card{
        margin-bottom:10px;
        padding:10px;
        border-radius:12px;
        background:#ffe9f6;
        border:1px solid #ffd1ec;
        box-shadow:0 2px 6px rgba(0,0,0,0.03);
    }

    .space-header{
        display:flex;
        justify-content:space-between;
        align-items:center;
        gap:6px;
        margin-bottom:6px;
    }

    .badge-nick{
        font-size:13px;
        font-weight:600;
        padding:4px 10px;
        border-radius:999px;
        background:#ffcae7;
        color:#8c325c;
    }

    .badge-id{
        font-size:11px;
        padding:4px 8px;
        border-radius:999px;
        background:#fff2fa;
        color:#a44071;
        display:inline-flex;
        align-items:center;
        gap:4px;
        margin-top:4px;
    }

    .badge-id button{
        padding:2px 7px;
        font-size:10px;
        border-radius:999px;
        background:#ff9ac5;
        color:#fff;
    }

    .btn-delete-card{
        background:#ffd0e7;
        color:#d2477f;
        font-size:11px;
        padding:5px 10px;
        display:inline-flex;
        align-items:center;
        gap:3px;
    }

    .space-fields{
        display:flex;
        flex-wrap:wrap;
        gap:6px;
        margin-top:6px;
    }

    .field-chip{
        display:inline-flex;
        align-items:center;
        gap:4px;
        padding:4px 8px;
        border-radius:999px;
        background:#fff3fb;
        font-size:11px;
    }

    .field-chip input[type="checkbox"]{
        width:18px;
        height:18px;
        accent-color:#ff6fa8;
        margin:0;
    }

    .space-memo textarea{
        min-height:50px;
        font-size:12px;
        margin-top:6px;
    }

    .small-helper{
        font-size:11px;
        color:#a66b8b;
        margin-top:4px;
    }

    @media (min-width:720px){
        body{
            max-width:640px;
            margin:0 auto;
        }
    }
</style>
</head>

<body>

<h1>ğŸ° ë‚­ - ìˆ™ì œ ì²´í¬</h1>
<div class="tag">ì‚¬ìš©ì ID: ë‚­ (í•‘í¬)</div>

<!-- ì˜¤ëŠ˜ì˜ í•œë§ˆë”” -->
<div class="card">
    <div class="section-title">ğŸ“Œ ì˜¤ëŠ˜ì˜ í•œë§ˆë””</div>

    <div class="input-small-label">ğŸ¥• ê´€ë¦¬ì â†’ ë‚­</div>
    <div id="adminMessageBox"
         style="white-space:pre-line; padding:8px; border-radius:10px; border:1px solid #ffcfe4; background:#ffeef7; font-size:13px;">
        (ê´€ë¦¬ìê°€ ì•„ì§ ë©”ì‹œì§€ë¥¼ ë‚¨ê¸°ì§€ ì•Šì•˜ì–´ìš”)
    </div>

    <div style="height:10px;"></div>

    <div class="input-small-label">ğŸ° ë‚­ â†’ ê´€ë¦¬ì</div>
    <textarea id="userMessage" placeholder="ì˜¤ëŠ˜ í•˜ê³  ì‹¶ì€ ë§ì„ ì ì–´ì£¼ì„¸ìš”"></textarea>
    <div style="margin-top:6px; text-align:right;">
        <button class="btn-save" onclick="saveUserMessage()">ì €ì¥</button>
    </div>
</div>

<!-- ì˜¤ëŠ˜ì˜ ìˆ™ì œ ìš”ì•½ (ì½ê¸° ì „ìš©) -->
<div class="card">
    <div class="section-title">ğŸ“Š ì˜¤ëŠ˜ì˜ ìˆ™ì œ ìš”ì•½</div>
    <table class="summary-table">
        <tr>
            <th></th>
            <th>ì—­íŒ¬</th>
            <th>ë°©ì…€</th>
            <th>ìˆ™ì œ</th>
            <th>ì‚¬ì§„</th>
            <th>ì›€ì§¤</th>
        </tr>
        <tr>
            <td class="summary-label-cell">ì˜¤ëŠ˜</td>
            <td id="today-ì—­íŒ¬">0</td>
            <td id="today-ë°©ì…€">0</td>
            <td id="today-ìˆ™ì œ">0</td>
            <td id="today-ì‚¬ì§„">0</td>
            <td id="today-ì›€ì§¤">0</td>
        </tr>
    </table>
</div>

<!-- ëˆ„ì  ìˆ™ì œ ìš”ì•½ (ì½ê¸° ì „ìš©) -->
<div class="card">
    <div class="section-title">ğŸ“Š ëˆ„ì  ìˆ™ì œ ìš”ì•½</div>
    <table class="summary-table">
        <tr>
            <th></th>
            <th>ì—­íŒ¬</th>
            <th>ë°©ì…€</th>
            <th>ìˆ™ì œ</th>
            <th>ì‚¬ì§„</th>
            <th>ì›€ì§¤</th>
        </tr>
        <tr>
            <td class="summary-label-cell">ëˆ„ì </td>
            <td id="total-ì—­íŒ¬">0</td>
            <td id="total-ë°©ì…€">0</td>
            <td id="total-ìˆ™ì œ">0</td>
            <td id="total-ì‚¬ì§„">0</td>
            <td id="total-ì›€ì§¤">0</td>
        </tr>
    </table>
</div>

<!-- ìˆ™ì œ ì¹´ë“œ ëª©ë¡ -->
<div class="card">
    <div class="section-title">ğŸ“¦ ìˆ™ì œ ì¹´ë“œ</div>
    <div class="small-helper">ì²´í¬í•˜ê³  ë©”ëª¨ë¥¼ ë‚¨ê¸¸ ìˆ˜ ìˆì–´ìš”. ì™„ë£Œëœ ì¹´ë“œëŠ” ì‚­ì œí•  ìˆ˜ ìˆì–´ìš”.</div>
    <div id="spacesContainer"></div>
</div>

<script>
/* Firebase ì´ˆê¸°í™” */
const firebaseConfig = {
    apiKey: "AIzaSyAHmLNi5VOuAE-gXnAg-fEfzylPZvzvfVo",
    authDomain: "daily-checklist-91e5a.firebaseapp.com",
    projectId: "daily-checklist-91e5a",
    storageBucket: "daily-checklist-91e5a.firebasestorage.app",
    messagingSenderId: "66394691958",
    appId: "1:66394691958:web:cf91f295456a2e10d18257",
    measurementId: "G-87WK4N4EGH"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* ì°¸ì¡° */
const todayMessagesRef = db.collection("today").doc("messages");
const summaryTodayRef  = db.collection("summary").doc("today");
const summaryTotalRef  = db.collection("summary").doc("total");
const configRef        = db.collection("config").doc("checklist");
const spacesRef        = db.collection("spaces");

/* ìƒíƒœ */
const statNames = ["ì—­íŒ¬","ë°©ì…€","ìˆ™ì œ","ì‚¬ì§„","ì›€ì§¤"];
let fields = [];
let spacesData = [];

/* ê¸°ë³¸ summary */
const emptySummary = {
    "ì—­íŒ¬":0,"ë°©ì…€":0,"ìˆ™ì œ":0,"ì‚¬ì§„":0,"ì›€ì§¤":0
};

/* ì˜¤ëŠ˜ì˜ í•œë§ˆë”” ì‹¤ì‹œê°„ */
todayMessagesRef.onSnapshot(doc=>{
    if(!doc.exists){
        todayMessagesRef.set({
            adminMessage:"",
            userMessage:"",
            date:new Date().toISOString()
        },{merge:true});
        return;
    }
    const data = doc.data();
    document.getElementById("adminMessageBox").innerText =
        data.adminMessage || "(ê´€ë¦¬ìê°€ ì•„ì§ ë©”ì‹œì§€ë¥¼ ë‚¨ê¸°ì§€ ì•Šì•˜ì–´ìš”)";
    document.getElementById("userMessage").value = data.userMessage || "";
});

/* ì˜¤ëŠ˜ ìš”ì•½ */
summaryTodayRef.onSnapshot(doc=>{
    if(!doc.exists){
        summaryTodayRef.set(emptySummary,{merge:true});
        return;
    }
    const data = doc.data();
    statNames.forEach(name=>{
        const el = document.getElementById("today-"+name);
        if(el) el.textContent = data[name] ?? 0;
    });
});

/* ëˆ„ì  ìš”ì•½ */
summaryTotalRef.onSnapshot(doc=>{
    if(!doc.exists){
        summaryTotalRef.set(emptySummary,{merge:true});
        return;
    }
    const data = doc.data();
    statNames.forEach(name=>{
        const el = document.getElementById("total-"+name);
        if(el) el.textContent = data[name] ?? 0;
    });
});

/* í•­ëª© ëª©ë¡ */
configRef.onSnapshot(doc=>{
    if(!doc.exists){
        configRef.set({fields:[]});
        return;
    }
    fields = doc.data().fields || [];
    renderSpaces();
});

/* spaces ì‹¤ì‹œê°„ */
spacesRef.onSnapshot(snapshot=>{
    spacesData = snapshot.docs.map(d=>({id:d.id, ...d.data()}));
    renderSpaces();
});

/* ì‚¬ìš©ì ë©”ì‹œì§€ ì €ì¥ */
function saveUserMessage(){
    const msg = document.getElementById("userMessage").value;
    todayMessagesRef.set({
        userMessage:msg,
        date:new Date().toISOString()
    },{merge:true})
    .then(()=>alert("ë©”ì‹œì§€ë¥¼ ì €ì¥í–ˆì–´ìš”."))
    .catch(()=>alert("ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´ìš”."));
}

/* ID ë³µì‚¬ */
function copyUserId(value){
    if(!value) return;
    if(navigator.clipboard && navigator.clipboard.writeText){
        navigator.clipboard.writeText(value)
            .then(()=>alert("ì•„ì´ë””ë¥¼ ë³µì‚¬í–ˆì–´ìš”: "+value))
            .catch(()=>alert("ë³µì‚¬ ì¤‘ ë¬¸ì œê°€ ìƒê²¼ì–´ìš”. ì§ì ‘ ë³µì‚¬í•´ ì£¼ì„¸ìš”."));
    }else{
        alert("ì´ ë¸Œë¼ìš°ì €ì—ì„œëŠ” ìë™ ë³µì‚¬ê°€ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì§ì ‘ ë³µì‚¬í•´ ì£¼ì„¸ìš”.");
    }
}

/* ì²´í¬ ì—…ë°ì´íŠ¸ */
function updateSpaceCheck(docId, field, checked){
    spacesRef.doc(docId).update({
        ["checks."+field]:checked
    }).catch(()=>alert("ì²´í¬ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´ìš”."));
}

/* ë©”ëª¨ ì—…ë°ì´íŠ¸ */
function updateSpaceMemo(docId, value){
    spacesRef.doc(docId).update({
        memo:value
    }).catch(()=>alert("ë©”ëª¨ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´ìš”."));
}

/* ì¹´ë“œ ì‚­ì œ (ìœ ì €ìš©) */
function deleteSpace(docId){
    if(!confirm("ì´ ìˆ™ì œë¥¼ ì™„ë£Œí•˜ì…¨ë‚˜ìš”?")) return;
    spacesRef.doc(docId).delete()
        .catch(()=>alert("ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´ìš”."));
}

/* ì¹´ë“œ ë Œë”ë§ */
function renderSpaces(){
    const container = document.getElementById("spacesContainer");
    container.innerHTML = "";

    if(!spacesData.length){
        container.innerHTML = '<div class="small-helper">ì•„ì§ ë“±ë¡ëœ ìˆ™ì œ ì¹´ë“œê°€ ì—†ì–´ìš”.</div>';
        return;
    }

    spacesData.forEach(item=>{
        const checks = item.checks || {};
        const card = document.createElement("div");
        card.className = "space-card";

        card.innerHTML = `
            <div class="space-header">
                <div>
                    <div class="badge-nick">ë‹‰ë„¤ì„: ${item.nickname || ""}</div>
                    <div class="badge-id">
                        <span>ì•„ì´ë””: ${item.userid || ""}</span>
                        <button type="button" onclick="copyUserId('${item.userid || ""}')">ë³µì‚¬</button>
                    </div>
                </div>
                <button type="button" class="btn-delete-card" onclick="deleteSpace('${item.id}')">
                    ğŸ¥• ì‚­ì œ
                </button>
            </div>
            <div class="space-fields">
                ${fields.map(name=>`
                    <div class="field-chip">
                        <input type="checkbox"
                               ${checks[name] ? "checked" : ""}
                               onchange="updateSpaceCheck('${item.id}','${name}',this.checked)">
                        <span>${name}</span>
                    </div>
                `).join("")}
            </div>
            <div class="space-memo">
                <div class="input-small-label">ë©”ëª¨</div>
                <textarea onchange="updateSpaceMemo('${item.id}',this.value)">${item.memo || ""}</textarea>
            </div>
        `;
        container.appendChild(card);
    });
}
</script>

</body>
</html>
